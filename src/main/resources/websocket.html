<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Realtime Notification</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>

<h2>Thông báo mới:</h2>
<div id="notifications"></div>
<div id="success-message" style="color: green; font-weight: bold;"></div>
<div id="error-message" style="color: red; font-weight: bold;"></div>

<script>
    const userId = 'ac883912-dd12-4ab7-b551-6711d56b60db';
    const token = "eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJoYWxlMDA4N0B1bmkuc3lkbmV5LmVkdS5hdSIsInN1YiI6ImE2Nzk5ZGY2LTIwZDgtNDgyYy05Y2FmLWJkN2UzZDkwOTQ0ZiIsImV4cCI6MTczNzEzOTc4NCwiaWF0IjoxNzM3MTM2MTg0LCJqdGkiOiJmNTlkMTA0ZS04OGNiLTQ5OTktOTRkYy01NGJlM2E4MWY2ZjIiLCJzY29wZSI6IkFETUlOIn0.zBLUFXIQSZaE7Dy1sOb8yxoGfC1WKMp5hi5S0BTXtSY"; // JWT token

    // Pass the token in the URL
    const socket = new SockJS(`http://localhost:8080/api/v1/ws?token=${token}`);
    const stompClient = Stomp.over(socket);

    stompClient.debug = function (str) {
        console.log(str);
    };

    stompClient.connect({}, function (frame) {
        console.log('Connected: ' + frame);
        document.getElementById("success-message").innerText = "WebSocket connect successfully.";

        // Subscribe to the user's notification topic
        stompClient.subscribe(`/topic/notification/${userId}`, function (notification) {
            const message = notification.body;
            console.log(message);
            const div = document.createElement("div");
            div.innerText = message;
            document.getElementById("notifications").appendChild(div);
        });
    }, function (error) {
        console.error('Connection error:', error);

        let errorMsg = "WebSocket connection failed. Please try again later.";
        if (error && error.headers && error.headers.message) {
            errorMsg = "Error: " + error.headers.message;
        }

        document.getElementById("error-message").innerText = errorMsg;
    });

    // Handle unexpected disconnection
    socket.onclose = function (event) {
        document.getElementById("error-message").innerText = "WebSocket connection closed.";
    };
</script>

</body>
</html>
